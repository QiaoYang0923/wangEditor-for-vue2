<script lang="ts">
import Vue from 'vue';
import { createToolbar } from '@wangeditor/editor';
import emitter from '../utils/emitter';
import { getEditor } from '../utils/editor-map';

export default Vue.extend({
  name: 'Toolbar',
  render(h) {
    return h('div', { ref: 'box' });
  },
  props: ['editorId', 'defaultConfig', 'mode'],
  created() {
    if (this.editorId == null) {
      throw new Error('Need `editorId` props when create <Editor/> component');
    }
    // 当 editor 创建时，创建 toolbar
    emitter.on(`w-e-created-${this.editorId}`, this.create);
  },
  methods: {
    // 创建 toolbar
    create() {
      if (this.$refs.box == null) return;

      const editor = getEditor(this.editorId);
      if (editor == null) return;

      createToolbar({
        editor,
        selector: this.$refs.box as Element,
        config: this.defaultConfig || {},
        mode: this.mode || 'default',
      });
    },
  },
  beforeDestroy() {
    // 组件销毁及时 off 自定义事件，防止内存泄漏
    emitter.off(`w-e-created-${this.editorId}`, this.create);
  },
});
</script>
